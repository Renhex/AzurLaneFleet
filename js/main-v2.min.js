function add_search_event(){let e=document.querySelector("#search_input");if(!e)return console.log("search_input not found");e.addEventListener("input",ship_name_search);let t=$("#shipselect");t.on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()}),t.on("hide.bs.modal",()=>e.value=""),setTimeout(()=>window.add_search_event=void 0)}function ship_name_search(e){let t=e.target.value.toLowerCase();if(!t)return shipDisplay();console.log("search:",t);let n=document.querySelectorAll("#shiplist button");n.forEach(e=>{if("000000"!=e.id){let n=ship_data[e.id],i=[n.tw_name,n.cn_name,n.en_name.toLowerCase(),n.jp_name,n.english_name.toLowerCase()].some(e=>e.includes(t));if(i){if(n){let t=isCorrectShipType(n.type);e.style.display=t?"":"none",e.setAttribute("displayed",!!t)}}else e.style.display="none",e.setAttribute("displayed",!1)}}),countShipDisplayed()}function emptyfleet(){let e="No4BgGk6qhdC5Y2gpLlze5nEZTQMwQEYsg";e=LZString.decompressFromEncodedURIComponent(e),updateFleetDataBox(e),loadDataByID(),disableInvalidMoveButton()}function dumpID(e=!1,t=[]){function n(){let n=[],i=[];return t.length?t.forEach(e=>n.push(dumpFleet(e))):fleet_data.forEach(e=>n.push(dumpFleet(e))),i=n,n=JSON.stringify(n,stringifyReplacer),n=updateFleetDataBox(n),e?i:n}switch(ALF_version){case.05:return n();default:throw Error("unknown version")}}function updateFleetDataBox(e=""){let t=document.getElementById("fleetdata"),n=`${e}!0.05!${CryptoJS.MD5(e).toString()}`;return n=LZString.compressToEncodedURIComponent(n),t.value=n,n}function dumpFleet(e=[]){let t=[];for(let n in e){if("id"==n)continue;let i=[];e[n].forEach(e=>{let t=[];e.item.forEach(e=>t.push(e.property.id)),i.push(t)}),t.push(i)}return t.push(e.sub_ship?2:1),t}function stringifyReplacer(e,t){if("string"==typeof t){if(""==t)return 0;{let e=parseInt(t,10);return e||t}}return t}function generateURL(){let e=dumpID(),t="BYFxAcGcC4HpYB4E4AsAzArgKwPYDYAncAcwDpiBLEYDAI1Ip1gEEAvDAgGQEMA7AUwBiAG378QsIA";t=new URL(t);let n=document.getElementById("url_box");if(t.searchParams.append("AFLD",e),t=t.href,t.length>=2e3)throw n.value="URL too long. You still can share it by use fleetdata below",Error("url too long");n.value=t}async function loadDataByID(){function e(e=""){throw message=`Error: Corrupted data!!! [${e}] should be [${o}]`,t.value=message,console.log(i),Error(message)}let t=document.getElementById("fleetdata"),n=t.value;"["!==n[0]&&(n=LZString.decompressFromEncodedURIComponent(n));let[i,a,o]=n.split("!"),r=!1;switch(parseFloat(a)){case.04:if(r=CryptoJS.SHA3(i,{outputLength:256}).toString(),r!==o)return e(r);i=JSON.parse(i),c_formation.sameAs(formation.v4)||buildFleet(formation.v4,!0);break;case.05:if(r=CryptoJS.MD5(i).toString(),r!==o)return e(r);i=JSON.parse(i),c_formation=extractFormation(i),buildFleet(c_formation,!0);break;default:throw Error(`unknown version ${a}`)}t.value="",await parseID(i),disableInvalidMoveButton()}function extractFormation(e=[]){if(!(e instanceof Array))throw Error("Invalid data");let t=[];return e.forEach(e=>{isNaN(e[e.length-1])||t.push(e[e.length-1])}),t}function saveCookie(e,t,n=365){let i=new Date,a=new Date;a.setTime(i.getTime()+1e3*n*60*60*24),document.cookie=`${e}=${t};expires=${a.toUTCString()};SameSite=Strict;`}function getCookie(){let e=document.cookie,t={},n=new Set(["expires","SameSite"]);return e=e.split(";").map(e=>e.trim()),e.forEach(e=>{let[i,a]=e.split("=");n.has(i)||(t[i]=a)}),t}async function parseID(e){if(!e.length)throw Error("no data");return e.forEach((e,t)=>{let n=e[e.length-1],i=!isNaN(n)&&n;e.forEach((e,n)=>{e instanceof Array&&e.forEach((e,a)=>{let o=!1;e.forEach((e,r)=>{if(""!==e&&0!==e||(e=0==r?"000000":"666666"),!o){let l=!1;l=i?1==i?`_${t}${n}${a}${r}`:`_${t}2${a}${r}`:t<4?`_${t}${n}${a}${r}`:`_${t}2${a}${r}`;let s={name:l,id:e};setCurrent(s),0===r?setShipAndEquip(s,!1):setEquip(s,!1),"000000"===e&&(o=!0)}})})})}),saveCookie("fleet",dumpID()),!0}function setRetro(){let e=$("#filter_retro");e.button("toggle"),retrofit_only=e.hasClass("active"),shipDisplay()}function setCode(e){$(e).button("toggle");let t=["tw","cn","en","jp"];[lan_ship_nation,lan_ship_type].forEach(e=>{e.forEach(e=>{t.forEach(t=>{let n=e[t],i=e.code;e[t]=n==i?e[`${t}_code`]:e.code})})})}function setEqCode(e){$(e).button("toggle");let t=["tw","cn","en","jp"];[lan_eq_nation].forEach(e=>{e.forEach(e=>{t.forEach(t=>{let n=e[t],i=e.code;e[t]=n==i?e[`${t}_code`]:e.code})})})}async function updateSetting(e){$(e).button("toggle");let t=e.name.split("_"),n=t[0],i=t[1],a=parseInt(t[2],10);if("ship"==n){if("nation"===i)await updateFilter("nation",a,i);else if("type"===i)switch(c_side){case"0":await updateFilter("front",a,i);break;case"1":await updateFilter("back",a,i);break;case"2":await updateFilter("sub",a,i);break;default:throw Error(`unknown ship type ${i}`)}else"rarity"===i&&(await updateFilter("rarity",a,i),e.style.color=e.style.color.length>0?"":"gold");shipDisplay()}else if("equip"==n){switch(i){case"nation":await updateFilter("eq_nation",a,i);break;case"type":await updateFilter("eq_type",a,i);break;case"rarity":await updateFilter("eq_rarity",a,i),e.style.color=e.style.color.length>0?"":"gold";break;case"tier":await updateFilter("eq_tier",a,i);break;default:throw Error(`unknown equip type ${i}`)}equipDisplay()}}async function updateFilter(e,t,n){let i=filter_setting[e].has(t),a=(e,t)=>filter_setting[e].add(t),o=(e,t)=>filter_setting[e].delete(t),r=(e,t)=>i?o(e,t):a(e,t);if(0!=t)r(e,t);else if(0==t)if("type"==n){let e=["front","back","sub"];i?e.forEach(e=>o(e,0)):e.forEach(e=>a(e,0))}else r(e,0);return!0}function shipDisplay(){let e=document.querySelectorAll("#shiplist button");e.forEach(e=>{if("000000"!=e.id){let t=parseInt(e.id,10),n=ship_data[t].nationality,i=ship_data[t].type,a=ship_data[t].rarity,o=ship_data[t].retro,r=isShipSelect(n,i,a,o);e.style.display=r?"":"none",e.setAttribute("displayed",!!r)}}),document.getElementById("allow_dup_btn").classList.contains("active")||hideShipInFleet(),countShipDisplayed()}function countShipDisplayed(){document.querySelector("#ship_count").textContent=document.querySelectorAll("#shiplist button[displayed='true']").length}function hideShipInFleet(){let e=[];for(let t in fleet_data[c_fleet])"id"!=t&&fleet_data[c_fleet][t].forEach(t=>{let n=t.item[0].property.id;""!=n&&e.push(n)});e.forEach(e=>{let t=document.getElementById(e);t.style.display="none",t.setAttribute("displayed",!1)})}function isCorrectShipType(e){return!("0"===c_side&&!type_front.has(e))&&(!("1"===c_side&&!type_back.has(e))&&!("2"===c_side&&!type_sub.has(e)))}function isShipSelect(e,t,n,i){if(!isCorrectShipType(t))return!1;let a=!1,o=!1,r=!1;switch(c_side){case"0":filter_setting.front.has(t)||0===filter_setting.front.size?o=!0:filter_setting.front.has(0)&&other_front.has(t)&&(o=!0);break;case"1":filter_setting.back.has(t)||0===filter_setting.back.size?o=!0:filter_setting.back.has(0)&&other_back.has(t)&&(o=!0);break;case"2":filter_setting.sub.has(t)||0===filter_setting.sub.size?o=!0:filter_setting.sub.has(0)&&other_sub.has(t)&&(o=!0);break;default:console.log("unknown type")}if(!o)return!1;if(filter_setting.nation.has(e)||0===filter_setting.nation.size)a=!0;else{if(!filter_setting.nation.has(0)||!other_nation.has(e))return!1;a=!0}return!(!filter_setting.rarity.has(n)&&0!==filter_setting.rarity.size)&&(r=!0,!![a,o,r].isAll()&&(!retrofit_only||1!==i))}function isEquipSelect(e,t,n,i){[e,t,n,i].forEach(e=>parseInt(e));let a=!1,o=!1,r=!1,l=!1;if(filter_setting.eq_nation.has(e)||0===filter_setting.eq_nation.size)a=!0;else{if(!filter_setting.eq_nation.has(0)||!eq_other_nation.has(e))return!1;a=!0}return!(!filter_setting.eq_type.has(t)&&0!==filter_setting.eq_type.size)&&(o=!0,!(!filter_setting.eq_rarity.has(n)&&0!==filter_setting.eq_rarity.size)&&(r=!0,!(!filter_setting.eq_tier.has(i)&&0!==filter_setting.eq_tier.size)&&(l=!0,!0)))}function setCurrent(e){let t=e.name;if([c_fleet,c_side,c_pos,c_item]=[t[1],t[2],t[3],t[4]],"0"===c_item){let e=!1;switch(c_side){case"0":e=type_front;break;case"1":e=type_back;break;case"2":e=type_sub;break;default:throw Error(`${setCurrent.name}: unknown type`)}lan_ship_type.forEach(t=>t.display=!!e.has(t.id)||0==t.id),shipDisplay()}else{let e=getSide(),t=fleet_data[c_fleet][e][c_pos].item[c_item].property.type,n=new Set(t);lan_eq_type.forEach(e=>e.display=!!n.has(parseInt(e.id))),"true"==document.getElementById("always_reset_equip_filter").ariaPressed&&resetEquipFilter(!0),equipDisplay()}}function setButtonStats(e,t=!0){function n(){e.click(),e.classList.add("active"),e.ariaPressed=!0}function i(){e.click(),e.classList.remove("active"),e.ariaPressed=!1}t?e.classList.contains("active")||n():e.classList.contains("active")&&i()}function autoUseDefault(e){$(e).button("toggle"),e.classList.contains("active")?resetEquipFilter(!0):resetEquipFilter(!1)}function resetEquipFilter(e=!1){const t=new Set(e?[6,5,4]:[]),n=new Set(e?[0,3]:[]);document.querySelectorAll("#eq_tier button").forEach(e=>setButtonStats(e,!!n.has(parseInt(e.value,10)))),document.querySelectorAll("#eq_rarity button").forEach(e=>setButtonStats(e,!!t.has(parseInt(e.value,10)))),document.querySelectorAll("#eq_nation button,#eq_type button").forEach(e=>setButtonStats(e,!1)),filter_setting.eq_type=new Set,filter_setting.eq_nation=new Set,filter_setting.eq_rarity=t,filter_setting.eq_tier=n}function equipCheck(e){function t(){n(r,"src","4.","3."),n(l,"src","ame_4","ame_3"),i(d,"bg","4.","3."),i(d,"frame","ame_4","ame_3"),p?(_="boolean"==typeof d.icon_cache?_:d.icon_cache,s.setAttribute("src",_),d.icon=_):(n(s,"src",f,_),i(d,"icon",f,_)),m.forEach(e=>{c.setAttribute(e,o[`${e}_name`]),d[e]=o[`${e}_name`]}),c.textContent=o[`${lan}_name`]}function n(e,t,n,i){e.setAttribute(t,e.getAttribute(t).replace(n,i))}function i(e,t,n,i){e[t]=e[t].replace(n,i)}let a=parseInt(atob("MjgzNDA="),10),o=document.getElementById(String(a)),r=o.querySelector(".bg"),l=o.querySelector(".frame"),s=o.querySelector(".icon"),c=o.querySelector("[name=name]"),d=sorted_equip_data.find(e=>e.id==a),p=!!d.icon_cache;a-=40;let u=parseInt(atob("MTA4MDIw"),10);u=p?sorted_ship_data.find(e=>e.id==u):window[atob("c2hpcF9kYXRh")][u],o=equip_data[a],eqck=!(!filter_setting.sub.has(8)||!filter_setting.sub.has(17));let _=p?d.icon:`${atob("ZXF1aXBzLw==")}${a}`,f=p?u.icon:`${atob("c2hpcGljb24v")}${u.painting}`,m=["tw","cn","en","jp"];(e===atob("MjA3MDUw")||e===atob("MzA3MDcw"))&&eqck?(n(r,"src","3.","4."),n(l,"src","ame_3","ame_4"),i(d,"bg","3.","4."),i(d,"frame","ame_3","ame_4"),p?(s.setAttribute("src",f),d.icon=f,"boolean"==typeof d.icon_cache&&(d.icon_cache=_)):(n(s,"src",_,f),i(d,"icon",_,f)),m.forEach(e=>{c.setAttribute(e,u[p?e:`${e}_name`]),d[e]=u[p?e:`${e}_name`]}),c.textContent=u[p?lan:`${lan}_name`]):t()}async function equipDisplay(){let e=getSide(),t=fleet_data[c_fleet][e][c_pos].item[c_item].property,n=t.type,i=document.querySelectorAll("#equiplist button"),a=fleet_data[c_fleet][e][c_pos].item[0].property,o=a.type,r=a.id,l=[];equipCheck(r),i.forEach(e=>{if("666666"!=e.id){let t=parseInt(e.id,10),i=equip_data[t],a=i.type,r=i.ship_type_forbidden;n.includes(a)?r.includes(o)?e.style.display="none":isEquipSelect(i.nationality,a,i.rarity,i.tech)?(e.style.display="",l.push(t)):e.style.display="none":e.style.display="none",e.setAttribute("displayed",""==e.style.display)}}),await limitEquip(l),countEquipDisplayed()}function countEquipDisplayed(){document.querySelector("#equip_count").textContent=document.querySelectorAll("#equiplist button[displayed='true']").length}async function limitEquip(e){let t=getSide(),n=fleet_data[c_fleet][t][c_pos],i=[];n.item.forEach((e,t)=>{let n=e.property.id;0!=t&&""!=n&&i.push(n)});let a=[];i.forEach(e=>{let t=parseInt(equip_data[e].equip_limit,10);isNaN(t)||t>0&&!a.includes(t)&&a.push(t)});let o=n.item[c_item].property.limit;return e.forEach(e=>{let t=parseInt(equip_data[e].equip_limit,10);if(t!=o&&a.includes(t)){let t=document.getElementById(e);t.style.display="none",t.setAttribute("displayed",!1)}}),!0}function sorting(e,t,n){return n?e.sort((e,n)=>e[t]<n[t]?1:-1):e.sort((e,n)=>e[t]>n[t]?1:-1),e}function setlang(e){let t=e.id;lan=ALF.lang=shipSelect.lang=equipSelect.lang=t,document.querySelectorAll("[name=name]").forEach(e=>e.textContent=e.getAttribute(t)),document.querySelectorAll("[ui_text='true']").forEach(e=>{"INPUT"==e.tagName?e.placeholder=e.getAttribute(`ui_${t}`):e.textContent=e.getAttribute(`ui_${t}`)}),saveCookie("lan",t),adjustEle()}function setEquip(e,t=!0){let n=getSide(),i=fleet_data[c_fleet][n][c_pos].item[c_item].property,a=parseInt(e.id,10);if(666666===a)i.tw=i.type_tw,i.cn=i.type_cn,i.en=i.type_en,i.jp=i.type_jp,i.frame=i.bg="",i.icon="ui/empty.png",i.id="";else{let e=["tw","cn","en","jp","icon","frame","bg","id","limit"],t=sorted_equip_data.find(e=>{if(e.id===a)return Object.assign({},e)});e.forEach(e=>i[e]=t[e])}t&&saveCookie("fleet",dumpID())}function getSide(){switch(c_side){case"0":return"front_ship";case"1":return"back_ship";case"2":return"sub_ship";default:throw Error(`${getSide.name}: unknown side type`)}}function setShipAndEquip(e,t=!0){let n=getSide(),i=fleet_data[c_fleet][n][c_pos],a=sorted_ship_data.find(t=>{if(t.id===`${e.id}`||t.id===e.id)return Object.assign({},t)}),o=i.item;const r=["tw","cn","en","jp","icon","frame","bg","id","type","rarity","star","base"];for(let t in o)if(o=i.item[t].property,"000000"===e.id)if("0"===t)r.forEach(e=>o[e]=""),o.icon=a.icon,o.base=[];else{for(let e in o)o[e]="";o.icon="ui/icon_back.png",o.fb=[],o.type=[],o.target="",o.quantity=""}else if("0"===t)r.forEach(e=>o[e]=a[e]);else{for(let e in o)o[e]="";let e=a[`e${t}`];o.type=e,o.icon="ui/empty.png";let n=parseInt(t,10)-1,r=i.item[0].property.base[n];null!=r&&e.some(e=>addQuantityList.includes(e))&&(o.quantity=r);let l=["tw","cn","en","jp"],s=[[],[],[],[]];e.forEach(e=>{l.forEach((t,n)=>{s[n].push(parsetype[e][t])})}),l.forEach((e,t)=>{o[e]=o[`type_${e}`]=s[t].join("/")}),o.target="#equipselect"}t&&saveCookie("fleet",dumpID())}function copyURL(){let e=document.querySelector("#url_box");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy")}function copyData(){let e=document.getElementById("fleetdata");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy")}function emptyData(){let e=document.getElementById("fleetdata");e.value=""}async function initial(){async function e(e="",t="",n=100,i={}){let a=document.createElement("progress");a.id=e,a.max=n,a.className="flex-col my-auto";let o=document.createElement("label");o.className="flex-col text-monospace m-1",o.textContent=t,o.for=e;let r=document.createElement("lable");r.className="flex-col text-monospace m-1",r.textContent=`0/${n}`,r.for=e;let l=document.createElement("div");l.className="row justify-content-center",l.appendChild(o),l.appendChild(r),l.appendChild(a);let s=document.querySelector("#loading_box");return s.appendChild(l),i.bar=a,i.lable=r,!0}async function t(){console.time(t.name);let e=[],n=0,i={},a={id:"uni_id",tw:"tw_name",cn:"cn_name",en:"en_name",jp:"jp_name",type:"type",nationality:"nationality",rarity:"rarity",star:"star",retro:"retro",base:"base_list",e1:"equip_1",e2:"equip_2",e3:"equip_3",e4:"equip_4",e5:"equip_5"};for(let t in ship_data){let o=Object.assign({},ship_data[t]),r={};for(let e in a)r[e]=o[a[e]];if(r.icon=`shipicon/${o.painting.toLowerCase()}.png`,r.bg=`ui/bg${o.rarity-1}.png`,r.frame=`ui/frame_${o.rarity-1}.png`,0===n){i=Object.assign({},r);for(let e in i)i[e]="";i.id="000000",i.en="remove",i.tw=i.cn="移除",i.jp="除隊",i.icon="ui/empty.png"}e.push(r),n++}return e=sorting(e,"type",!0),e=sorting(e,"nationality",!0),e=sorting(e,"rarity",!0),e.unshift(i),sorted_ship_data=Object.assign([],e),console.timeEnd(t.name),!0}async function n(){console.time(n.name);let e=[],t=0,i={id:"id",tw:"tw_name",cn:"cn_name",en:"en_name",jp:"jp_name",type:"type",nationality:"nationality",rarity:"rarity",fb:"ship_type_forbidden",limit:"equip_limit"};for(let n in equip_data){let a=Object.assign({},equip_data[n]),o={};for(let e in i)o[e]=a[i[e]];if(o.icon=`equips/${a.icon}.png`,1!=a.rarity?(o.bg=`ui/bg${a.rarity-1}.png`,o.frame=`ui/frame_${a.rarity-1}.png`):(o.bg=`ui/bg${a.rarity}.png`,o.frame=`ui/frame_${a.rarity}.png`),0===t){empty=Object.assign({},o);for(let e in empty)empty[e]="";empty.id="666666",empty.en="remove",empty.tw=empty.cn="移除",empty.jp="外す",empty.icon="ui/empty.png"}e.push(o),t++}return e=sorting(e,"nationality",!1),e=sorting(e,"type",!1),e=sorting(e,"rarity",!0),e.unshift(empty),sorted_equip_data=Object.assign([],e),console.timeEnd(n.name),!0}function i(e,t,n,i){return new Promise(a=>{setTimeout(()=>{let o=document.getElementById(t),r=document.createElement("div");r.className="container-fluid icon_box";let l=document.createElement("img");l.className="img-fluid icon",l.loading="lazy",l.src=e.icon;let s=document.createElement("img");s.className="img-fluid bg",s.src=e.bg;let c=document.createElement("img");c.className="img-fluid frame",c.src=e.frame,r.append(s,c,l);let d=document.createElement("div");d.className="container-fluid p-0 box";let p=document.createElement("span");p.className="justify-content-center item_name",p.setAttribute("name","name"),p.setAttribute("tw",e.tw),p.setAttribute("cn",e.cn),p.setAttribute("en",e.en),p.setAttribute("jp",e.jp),p.textContent=e[lan],d.append(r,p);let u=document.createElement("button");u.className="p-1 item_container",u.id=e.id,u.onclick=function(){n(this)},u.setAttribute("data-dismiss","modal"),u.append(d),o.append(u),i.bar.value++,i.lable.textContent=`${i.bar.value}/${i.bar.max}`,a()})})}async function a(){console.time(a.name);let t=[];return await e("create_ship","Generate Ships",sorted_ship_data.length,_loading_.ship),sorted_ship_data.forEach(e=>t.push(i(e,"shiplist",setShipAndEquip,_loading_.ship))),await Promise.all(t),console.timeEnd(a.name),!0}async function o(){console.time(o.name);let t=[];return await e("create_equip","Generate Equips",sorted_equip_data.length,_loading_.equip),sorted_equip_data.forEach(e=>t.push(i(e,"equiplist",setEquip,_loading_.equip))),await Promise.all(t),console.timeEnd(o.name),!0}function r(e="",t="ship",n=""){return`${"ship"==t?"shipicon":"equips"}_${e.replace(n,"$1")}`}async function l(){let t="imgToDataURL";console.time(t);let n=/.*(?:equips|shipicon)\/([^\.]+).*/,i=0,a={};sorted_ship_data.forEach((e,t)=>{let o=r(e.icon,"ship",n);0==t||a[o]||(a[o]={src:e.icon,id:o,data_url:""},i++)}),sorted_equip_data.forEach((e,t)=>{let o=r(e.icon,"equip",n);0==t||a[o]||(a[o]={src:e.icon,id:o,data_url:""},i++)});let o=[],l=[],c=_loading_.cache_image;await e("fetch_img","Fetch Images",i,c);for(let e in a){let t=a[e];l.push(s(t.src).then(e=>{t.data_url=e,c.bar.value++,c.lable.textContent=`${c.bar.value}/${c.bar.max}`})),o.push(t)}return await Promise.all(l),console.log(`fetch ${i} images`),console.timeEnd(t),o}async function s(e="",t=!1){function n(e){return new Promise((t,n)=>{var i=new FileReader;i.onload=(()=>{t(i.result)}),i.onerror=n,i.readAsDataURL(e)})}let i="file:"==window.location.protocol;return t||i?e:fetch(e).then(e=>e.blob()).then(e=>n(e))}async function c(t){let n="loadImgCache";console.time(n);let i=/.*(?:equips|shipicon)\/([^\.]+).*/,a=[],o=sorted_ship_data.length+sorted_equip_data.length-2,l=_loading_.load_cache;await e("load_cache","Loading Cache",o,l);for(let e of sorted_ship_data)"000000"!=e.id&&a.push(t.getImgCache(r(e.icon,"ship",i)).then(t=>{e.icon=t.data_url,e.icon_cache=!0,l.bar.value++,l.lable.textContent=`${l.bar.value}/${l.bar.max}`}));for(let e of sorted_equip_data)"666666"!=e.id&&a.push(t.getImgCache(r(e.icon,"equip",i)).then(t=>{e.icon=t.data_url,e.icon_cache=!0,l.bar.value++,l.lable.textContent=`${l.bar.value}/${l.bar.max}`}));return await Promise.all(a),console.log(`set ${a.length} src to image cache`),console.timeEnd(n),!0}async function d(e,t,n){const i=e.transaction(t,"readwrite"),a=n.map(e=>i.store.add(e));await Promise.all([...a,i.done])}async function p(){let e=getCookie();if(e.lan){let t=document.getElementById(e.lan);t.click()}else setlang({id:"en"}),saveCookie("lan",lan);let t=new URL(window.location.href),n=t.searchParams.get("AFLD"),i=document.querySelector("#fleetdata");if(n?(i.value=n,loadDataByID()):e.fleet?(i.value=e.fleet,loadDataByID()):saveCookie("fleet",dumpID()),1==e.allow_dup&&allow_dup(),1==e.thick_frame){let e=document.getElementById("frame_setting");setTimeout(()=>frameSize(e),0)}if(e.layout){let t=document.querySelector("#layout_setting");t.textContent=e.layout,switchLayout(t,!0)}return!0}async function u(){let e=number_of_fleet();if(e<=0)return;fleet_in_storage=[];for(let t=1;t<=e;t++){let e=`fleet_index_${t}`,n=storageManager("get",e);n&&(n.name&&n.fleet&&fleet_in_storage.push({name:n.name,fleet:n.fleet}))}let t=fleet_info.msg();return classManager(t,"exchange",msg_color.red,msg_color.green),t.textContent=`load ${fleet_in_storage.length} fleet`,console.log(t.textContent),!0}if(console.time(initial.name),await t(),await n(),!indexedDB&&!window.idb){let e=document.querySelector("#loading_box"),t=document.createElement("div");return t.textContent="not support indexedDB",t.className="row text-center text-monospace",e.appendChild(t),void console.log("not support indexedDB")}{const[e,t]=await initialDB(db_name,db_ver);let n=await t.allKeys();if(!n.length){let t=await l();t.length>0&&(await d(e,db_name,t),console.log(`cached ${t.length} images`))}await c(t)}await a(),await o(),addLanguageToEle(),add_search_event(),splitButtonGroup("shipnation"),splitButtonGroup("eq_nation"),addWindowSizeEvent(),await p(),await u(),document.querySelector("#loading_box").style.display="none",document.querySelector("#app_area").style.display="",disableInvalidMoveButton(),console.timeEnd(initial.name),setTimeout(()=>window.initial=void 0)}function getPos(e){let t=e.getAttribute("pos");return parseInt(t[t.length-1],10)-1}function moveFleet(e){let t=getPos(e),n=parseInt(e.getAttribute("data"),10),i=dumpID(!0),a=[],o=fleet_info.msg();if(n<0){if(t-1<0)throw classManager(o,"exchange",msg_color.green,msg_color.red),o.textContent="yes",Error("can't move over 0")}else if(t+1>fleet_data.length-1)throw classManager(o,"exchange",msg_color.green,msg_color.red),o.textContent="yes",Error("can't move under 1");n=n<0?t-1:t+1,a=i.splice(t,1).flat(),i.splice(n,0,a),i=JSON.stringify(i,stringifyReplacer),updateFleetDataBox(i),loadDataByID(),disableInvalidMoveButton()}function disableInvalidMoveButton(){let e=document.querySelectorAll('[onclick^="moveFleet"],[onclick^="deleteFleet"]'),t=document.querySelector('[pos="Fleet_1"][onclick^="moveFleet"][data="-1"]'),n=document.querySelector(`[pos="Fleet_${fleet_data.length}"][onclick^="moveFleet"][data="1"]`);e.length&&e.forEach(e=>e.removeAttribute("disabled")),t&&t.setAttribute("disabled",!0),n&&n.setAttribute("disabled",!0),1===fleet_data.length&&e.length&&e.forEach(e=>e.setAttribute("disabled",!0))}function deleteFleet(e){let t=getPos(e),n=dumpID(!0),i=[],a=fleet_info.msg();if(n.forEach((e,n)=>{n!=t&&i.push(e)}),!i.length)throw classManager(a,"exchange",msg_color.green,msg_color.red),a.textContent="yes",Error("you can't delete the last fleet");i=JSON.stringify(i,stringifyReplacer),updateFleetDataBox(i),loadDataByID()}function insertFleet(e){let t=e.getAttribute("data").split(",").map(e=>parseInt(e,10)),n=t[0],i=getPos(e),a=t[1];if(i<0)throw Error("position must be positive");if(![0,1].includes(a))throw Error("unknown direction");let o=dumpID(!0),r={},l=[];switch(n){case 1:r=newNormalFleet(0,creatEmptyShip());break;case 2:r=newSubFleet(0,creatEmptyShip());break;default:throw Error("unknown formation")}r=dumpFleet(r),o.forEach((e,t)=>{0==a&&i==t&&l.push(r),l.push(e),1==a&&i==t&&l.push(r)}),l=JSON.stringify(l,stringifyReplacer),updateFleetDataBox(l),loadDataByID()}function buildFleet(e=[],t=!1){if(!e.length)throw Error("formation data is empty!!");let n=creatEmptyShip(),i=[];if(e.forEach((e,t)=>{switch(e){case 1:i.push(newNormalFleet(t,n));break;case 2:i.push(newSubFleet(t,n));break;default:throw Error("unknown formation")}}),c_formation=e,!t)return i;ALF.fleets=fleet_data=i}function creatEmptyShip(){let e=[];for(let t=0;t<6;t++){let n=[];if(0===t){let e={id:"",type:"",star:"",rarity:"",tw:"",en:"",cn:"",jp:"",icon:"ui/empty.png",bg:"",frame:"",target:"#shipselect",base:[],quantity:""};n=e}else{let e={id:"",type:[],star:"",rarity:"",tw:"",en:"",cn:"",jp:"",icon:"ui/icon_back.png",bg:"",frame:"",target:"",fb:[],type_tw:"",type_cn:"",type_en:"",type_jp:"",limit:"",quantity:""};n=e}e.push({id:t,property:[]}),e[t].property=Object.assign({},n)}return e}function newNormalFleet(e,t){if(isNaN(e)||e<0)throw Error("no fleet_id");let n=[],i=[];for(let a=0;a<6;a++){let o=[];if(a<3){for(let n in t){let i=`_${e}0${a}${n}`,r=Object.assign({},t[n].property);r.pos="front",0==n&&(r.ship_pos=pos_table.front[a]),o.push({id:i,property:r})}n.push({id:`fleet_${e}_front_ship${a}`,item:o})}else{for(let n in t){let i=`_${e}1${a-3}${n}`,r=Object.assign({},t[n].property);o.push({id:i,property:r}),r.pos="back",0==n&&(r.ship_pos=pos_table.back_sub[a-3])}i.push({id:`fleet_${e}_back_ship${a-3}`,item:o})}}return{id:`Fleet_${e+1}`,front_ship:n,back_ship:i}}function newSubFleet(e,t){if(isNaN(e)||e<0)throw Error("no fleet_id");let n=[];for(let i=0;i<3;i++){let a=[];for(let n in t){let o=`_${e}2${i}${n}`,r=Object.assign({},t[n].property);r.pos="sub",a.push({id:o,property:r}),0==n&&(r.ship_pos=pos_table.back_sub[i])}n.push({id:`fleet_${e}_sub_ship${i}`,item:a})}return{id:`Fleet_${e+1}`,sub_ship:n}}function buildShipSelectOption(){console.time(buildShipSelectOption.name);let e=["tw","cn","en","jp"];lan_ship_nation.forEach(t=>{t.name=`ship_nation_${t.id}`,t.tw=t.cn,e.forEach(e=>t[`${e}_code`]=t[e])}),lan_ship_type.forEach(t=>{t.name=`ship_type_${t.id}`,t.display=!1,t.tw=t.cn,e.forEach(e=>t[`${e}_code`]=t[e])}),lan_ship_rarity.forEach(t=>{t.name=`ship_rarity_${t.id}`,e.forEach(e=>t[e]=t.code)}),console.timeEnd(buildShipSelectOption.name),setTimeout(()=>window.buildShipSelectOption=void 0)}function buildEquipSelectOption(){console.time(buildEquipSelectOption.name);let e=["tw","cn","en","jp"];lan_eq_nation.forEach(e=>{e.name=`equip_nation_${e.id}`}),lan_eq_type.forEach(e=>{e.name=`equip_type_${e.id}`,e.display=!1}),lan_eq_rarity.forEach(t=>{t.name=`equip_rarity_${t.id}`,e.forEach(e=>t[e]=t.en)}),lan_eq_tier.forEach(t=>{t.name=`equip_tier_${t.id}`,e.forEach(e=>t[e]=`${t.id}`)}),console.timeEnd(buildEquipSelectOption.name),setTimeout(()=>window.buildEquipSelectOption=void 0)}function addLanguageToEle(){let e=["en","jp","tw"];lan_target_list.forEach(t=>{let n=document.querySelectorAll(`#${t.id},[ui_id=${t.id}]`);n.length>0?n.forEach(n=>{n.setAttribute("ui_text","true"),n.setAttribute("ui_cn",t.tw),e.forEach(e=>n.setAttribute(`ui_${e}`,t[e]))}):console.log(`id[${t.id}] not found`)})}function splitButtonGroup(e="",t=5,n=""){if(5!=t&&0==n.length)throw Error("max != 5, but no alt_class.");let i=document.getElementById(e),a=i.querySelectorAll("button");if(a.length<=5)return;let o=!1,r=0;a.forEach((e,a)=>{a%t==0&&(o=document.createElement("div"),o.className="btn-group d-flex flex-wrap ml-1"+(r>0?" mt-1":""),i.appendChild(o),r++),5!=t&&(e.className=n),o&&o.appendChild(e)}),i.className=""}function addWindowSizeEvent(){window.addEventListener("resize",adjustEle),$(window).width()<1300&&adjustEle()}function adjustEle(){let e=$(window).width(),t=1300,n="adjustEle_placeholder",i=[{ele:document.getElementById("option_box_1"),mode:"exchange",normal_class:"w-25",small_class:"w-50"},{ele:document.getElementById("fleet_storage"),mode:"exchange",normal_class:"w-50",small_class:"w-100"},{ele:document.getElementById("dialog_shipselect"),mode:"batch_exchange",normal_class:n.split(" "),small_class:"mw-100".split(" ")},{ele:document.getElementById("dialog_select_equip"),mode:"batch_exchange",normal_class:n.split(" "),small_class:"mw-100".split(" ")},{ele:document.getElementById("search_box"),mode:"exchange",normal_class:"d-flex",small_class:"flex-wrap"}];e<t?i.forEach(e=>classManager(e.ele,e.mode,e.normal_class,e.small_class)):i.forEach(e=>classManager(e.ele,e.mode,e.small_class,e.normal_class))}function classManager(e="",t="",n="",i=""){switch(t){case"exchange":e.classList.contains(n)&&e.classList.remove(n),e.classList.add(i);break;case"batch_exchange":(n&&i)instanceof Array&&(n&&i).length>0&&(n.forEach(t=>e.classList.remove(t)),i.forEach(t=>e.classList.add(t)))}}function fleetManager(e="",t=[]){switch(e){case"storage":let n=t.length;try{if(!(t instanceof Array))throw new Error("invalid data");if(0==n)throw new Error("no fleet data")}catch(e){console.log(e.message)}finally{for(let e=1;e<=n;e++)storageManager("set",`fleet_index_${e}`,t[e-1]);storageManager("set","num_of_fleet",n)}return console.log(`storage ${n} fleet data`),!0;case"clear":let i=number_of_fleet();for(let e=1;e<=i;e++)storageManager("remove",`fleet_index_${e}`);return storageManager("remove","num_of_fleet"),console.log(`remove ${i} old fleet data`),!0;default:throw Error(`unknown action: ${e}`)}}function number_of_fleet(){let e=storageManager("get","num_of_fleet");return e||0}function storageManager(e="get",t="",n=""){function i(e){let t=AFL_storage.getItem(e);return t?JSON.parse(t):null}function a(e,t){let n=JSON.stringify(t);AFL_storage.setItem(e,n)}switch(e){case"get":return i(t);case"set":return a(t,n);case"remove":return AFL_storage.removeItem(t);default:throw Error(`unknown action: ${e}`)}}function updateStorageList(){let e=fleet_info.list();e.innerHTML=fleet_in_storage.length>0?"":'<div class="dropdown-item text-light text-monospace" id="no_fleet">no fleet in storage...</div>',fleet_in_storage.forEach((t,n)=>{let i=decodeURIComponent(t.name),a=document.createElement("div");a.className="dropdown-item text-light text-monospace",a.textContent=`${n}_[${i}]`,a.onclick=function(){let e=fleet_info.select();e.textContent=`${n}_[${i}]`,e.setAttribute("sotrge_id",n),fleet_info.load().disabled=!1,fleet_info.remove().disabled=!1},e.appendChild(a)})}function saveStorage(){let e=fleet_in_storage.length;e<=0||(fleetManager("clear"),fleetManager("storage",fleet_in_storage))}function add_fleet(){let e=fleet_info.name(),t=e.value.trim(),n=encodeURIComponent(t),i=fleet_info.msg();if(!t||0==t.length)return classManager(i,"exchange",msg_color.green,msg_color.red),void(i.textContent="error: no fleet name");{let a=dumpID();fleet_in_storage.push({name:n,fleet:a}),saveStorage(),classManager(i,"exchange",msg_color.red,msg_color.green),i.textContent=`add fleet: ${t}`,e.value=""}}function load_fleet(){let e=fleet_info.msg(),t=fleet_info.select().getAttribute("sotrge_id");if(!t||isNaN(t))return classManager(e,"exchange",msg_color.green,msg_color.red),void(e.textContent="error: invalid fleet id");let n=fleet_in_storage[t];if(!n)return classManager(e,"exchange",msg_color.green,msg_color.red),void(e.textContent="error: no fleet data");let i=decodeURIComponent(n.name);classManager(e,"exchange",msg_color.red,msg_color.green),e.textContent=`load fleet:${t}_[${i}]`,fleet_info.name().value=i,clear_select();let a=document.getElementById("fleetdata");a.value=n.fleet,loadDataByID()}function clear_select(){let e=fleet_info.select();e.textContent="Select Fleet",e.removeAttribute("sotrge_id"),fleet_info.load().disabled=!0,fleet_info.remove().disabled=!0}function remove_fleet(){let e=fleet_info.msg(),t=fleet_info.select().getAttribute("sotrge_id");if(!t||isNaN(t))return classManager(e,"exchange",msg_color.green,msg_color.red),void(e.textContent="error: invalid fleet id");let n=fleet_in_storage[t];if(!n)return classManager(e,"exchange",msg_color.green,msg_color.red),void(e.textContent="error: no fleet data");let i=decodeURIComponent(n.name);classManager(e,"exchange",msg_color.red,msg_color.green),e.textContent=`remove fleet: ${t}_[${i}]`,clear_select(),fleet_in_storage.splice(t,1),saveStorage()}function frameSize(e){function t(e=""){if(e!=i)return o++,n?e.match(a)?e.replace(a,".png"):e.replace(".png","b.png"):e.replace(a,".png");r++}$(e).button("toggle");let n=!!e.ariaPressed,i=window.location.href,a=/b+\.png/,o=0,r=0;[sorted_equip_data,sorted_ship_data].forEach(e=>{e.forEach(e=>{
""!=e.frame&&(e.frame=t(e.frame))})}),document.querySelectorAll("img.frame").forEach(e=>{""!=e.currentSrc&&(e.src=t(e.currentSrc))}),console.log(`[${frameSize.name}] done: ${o}, failed: ${r}`),saveCookie("thick_frame",n?1:0)}function switchLayout(e,t=!1){function n(e=""){let t=[{target:"app_box",h:"container mw-100",v:"row justify-content-center py-1 px-5 m-0",v2:"d-table justify-content-center m-auto"},{target:"fleet_box_o",h:"d-grid justify-content-center",v:"d-grid border border-secondary",v2:"flex-row border border-secondary"},{target:"fleet_box_i",h:"row m-2 border border-secondary py-2",v:"col m-2",v2:"col m-2"}];t.forEach(t=>{document.querySelectorAll(`.${t.target}`).forEach(n=>{n.className=`${t[e]} ${t.target}`})})}const i={h:"Horizontal",v:"Vertical 1",v2:"Vertical 2"};switch(e.textContent){case i.h:t?(n("h"),e.textContent=i.h):(n("v"),e.textContent=i.v);break;case i.v:t?(n("v"),e.textContent=i.v):(n("v2"),e.textContent=i.v2);break;case i.v2:t?(n("v2"),e.textContent=i.v2):(n("h"),e.textContent=i.h)}saveCookie("layout",e.textContent)}function allow_dup(){let e=$("#allow_dup_btn");e.button("toggle"),saveCookie("allow_dup",e.hasClass("active")?"1":"0")}async function initialDB(e,t){const n=await idb.openDB(e,t,{upgrade(t){t.newVersion>t.oldVersion&&(console.log("clear old version"),t.deleteObjectStore(e)),t.createObjectStore(e,{keyPath:"id"})}}),i={getImgCache:async(t="")=>(await n).get(e,t),setImgCache:async(t="",i="")=>(await n).put(e,i,t),clear:async()=>(await n).clear(e),allKeys:async()=>(await n).getAllKeys(e)};return[n,i]}async function emptyCache(){const[e,t]=await initialDB(db_name,db_ver);await t.clear(),window.location.reload()}const lan_target_list=[{id:"allow_dup_btn",en:"Allow Duplicate",jp:"重複を許可する",tw:"允許重複的船"},{id:"layout_label",en:"Layout:",jp:"スタイル:",tw:"排版方式:"},{id:"add_fleet",en:"Save Current",jp:"現在の艦隊をセーブ",tw:"儲存目前艦隊"},{id:"select_fleet",en:"Select Fleet",jp:"艦隊を選択",tw:"選擇艦隊"},{id:"load_fleet",en:"Load Fleet",jp:"ロード",tw:"載入艦隊"},{id:"remove_fleet",en:"Delete",jp:"削除",tw:"刪除"},{id:"fleet_name_label",en:"Fleet Name",jp:"艦隊名",tw:"艦隊名稱"},{id:"emptyfleet",en:"Empty Current Fleet",jp:"現在の艦隊を空に",tw:"清空目前艦隊"},{id:"fleetdata_text",en:"Fleet data",jp:"艦隊データ",tw:"艦隊資料"},{id:"dumpdata",en:"Dump",jp:"ダンプ",tw:"匯出"},{id:"copyData",en:"Copy",jp:"コピー",tw:"複製"},{id:"emptyData",en:"Clear",jp:"クリア",tw:"清空"},{id:"loadDataByID",en:"Load",jp:"ロード",tw:"載入"},{id:"rebuild_cache_btn",en:"Rebuild Cache",jp:"キャッシュをクリア&再構築",tw:"重建快取"},{id:"select_ship",en:"Select Ship",jp:"艦船を選択",tw:"選擇艦船"},{id:"filter_nation",en:"Nation",jp:"陣営",tw:"國家"},{id:"filter_type",en:"Type",jp:"種類",tw:"種類"},{id:"filter_rarity",en:"Rarity",jp:"レア度",tw:"稀有度"},{id:"search_input",en:"Search",jp:"検索",tw:"搜尋"},{id:"filter_search_result",en:"Result",jp:"結果",tw:"結果"},{id:"filter_retro",en:"Retrofitted Only",jp:"改造された艦船だけ",tw:"只顯示改造後的"},{id:"select_equip",en:"Select Equip",jp:"装備を選択",tw:"選擇裝備"}],parsetype={1:{cn:"驅逐砲",en:"DD Gun",jp:"駆逐砲"},2:{cn:"輕巡砲",en:"CL Gun",jp:"軽巡砲"},3:{cn:"重巡砲",en:"CA Gun",jp:"重巡砲"},4:{cn:"戰艦砲",en:"BB Gun",jp:"戦艦砲"},5:{cn:"魚雷",en:"Torpedoe",jp:"魚雷"},6:{cn:"防空砲",en:"Anti-Air Gun",jp:"対空砲"},7:{cn:"戰鬥機",en:"Fighter",jp:"戦闘機"},8:{cn:"攻擊機",en:"Torpedo Bomber",jp:"攻撃機"},9:{cn:"爆擊機",en:"Dive Bomber",jp:"爆撃機"},10:{cn:"設備",en:"Auxiliary",jp:"設備"},11:{cn:"超巡砲",en:"CB Gun",jp:"超巡砲"},12:{cn:"水上機",en:"Seaplane",jp:"水上機"},13:{cn:"潛艇魚雷",en:"Submarine Torpedoe",jp:"潜水艦魚雷"},14:{cn:"爆雷",en:"Depth Charge",jp:"爆雷"},15:{cn:"反潛機",en:"ASW Bomber",jp:"対潜機"},17:{cn:"直升機",en:"ASW Helicopter",jp:"ヘリ"},18:{cn:"貨物",en:"Cargo",jp:"積載"}};Object.keys(parsetype).forEach(e=>parsetype[e].tw=parsetype[e].cn);const lan_ship_nation=[{id:1,cn:"白鷹",en:"Eagle Union",jp:"ユニオン",code:"USS"},{id:2,cn:"皇家",en:"Royal Navy",jp:"ロイヤル",code:"HMS"},{id:3,cn:"重櫻",en:"Sakura Empire",jp:"重桜",code:"IJN"},{id:4,cn:"鐵血",en:"Iron Blood",jp:"鉄血",code:"KMS"},{id:5,cn:"東煌",en:"Dragon Empery",jp:"東煌",code:"PRAN/ROC"},{id:6,cn:"撒丁帝國",en:"Sardegna Empire",jp:"サディア",code:"RN"},{id:7,cn:"北方聯合",en:"Northern Parliament",jp:"北連",code:"SN"},{id:8,cn:"自由鳶尾",en:"Iris Libre",jp:"アイリス",code:"FFNF"},{id:9,cn:"維希教廷",en:"Vichya Dominion",jp:"ヴィシア",code:"MNF"},{id:0,cn:"其他",en:"Other",jp:"その他",code:"Other"}],lan_ship_type=[{id:8,cn:"潛艇",en:"Submarine",jp:"潜水艦",code:"SS",pos:"sub"},{id:17,cn:"潛母",en:"Submarine Carrier",jp:"潜水空母",code:"SSV",pos:"sub"},{id:1,cn:"驅逐",en:"Destroyer",jp:"駆逐",code:"DD",pos:"front"},{id:2,cn:"輕巡",en:"Light Cruiser",jp:"軽巡",code:"CL",pos:"front"},{id:3,cn:"重巡",en:"Heavy Cruiser",jp:"重巡",code:"CA",pos:"front"},{id:18,cn:"超巡",en:"Large Cruiser",jp:"超甲巡",code:"CB",pos:"front"},{id:4,cn:"戰巡",en:"Battle Cruiser",jp:"巡洋戦艦",code:"BC",pos:"back"},{id:5,cn:"戰列",en:"Battle Ship",jp:"戦艦",code:"BB",pos:"back"},{id:6,cn:"輕航",en:"Light Carrier",jp:"軽空母",code:"CVL",pos:"back"},{id:7,cn:"航母",en:"Carrier",jp:"空母",code:"CV",pos:"back"},{id:13,cn:"重砲",en:"Monitor",jp:"砲艦",code:"BM",pos:"back"},{id:12,cn:"維修",en:"Repair Ship",jp:"工作",code:"AR",pos:"back"},{id:0,cn:"其他",en:"Other",jp:"その他",code:"Other"}],lan_ship_rarity=[{id:6,cn:"海上傳奇",en:"Decisive",jp:"UR",code:"★★★★★★"},{id:5,cn:"超稀有",en:"SuperRare",jp:"SSR",code:"★★★★★"},{id:4,cn:"精銳",en:"Elite",jp:"SR",code:"★★★★"},{id:3,cn:"稀有",en:"Rare",jp:"R",code:"★★★"},{id:2,cn:"普通",en:"Normal",jp:"N",code:"★★"}];buildShipSelectOption();const lan_eq_type=Object.keys(parsetype).map(e=>e=Object.assign({id:e},parsetype[e])),lan_eq_nation=lan_ship_nation.map(e=>Object.assign({},e)),lan_eq_tier=[{id:0},{id:3},{id:2},{id:1}],lan_eq_rarity=[{id:6,en:"★★★★★★"},{id:5,en:"★★★★★"},{id:4,en:"★★★★"},{id:3,en:"★★★"},{id:2,en:"★★"}];buildEquipSelectOption(),Vue.component("item-container",{props:["item","lang"],template:`\n        <button\n          class="p-1 item_container" \n\n          v-bind:name="item.id"\n          v-bind:pos="item.property.pos"\n          v-bind:data-target="item.property.target"\n\n          onclick="${setCurrent.name}(this)"\n          data-toggle="modal"          \n          >\n            <div class="container-fluid p-0 box">\n              <div class="icon_box">\n                <img class="img-fluid bg" v-bind:src="item.property.bg">\n                <img class="img-fluid frame" v-bind:src="item.property.frame">\n                <img class="img-fluid icon" v-bind:src="item.property.icon">\n                <span class="d-flex justify-content-start text-monospace itemq" v-text="item.property.quantity"></span>\n                <span class="d-flex justify-content-start text-monospace ship_pos2" v-text="item.property.ship_pos"></span>\n              </div>\n              <span class="justify-content-center item_name" v-text="item.property[lang]"></span>\n            </div>\n        </button>\n    `}),Vue.component("ship-container",{props:["ship","lang"],template:'\n        <div class="col">\n            <item-container\n                v-for="item in ship.item"\n                v-bind:key="item.id"\n                v-bind:item="item"\n                v-bind:lang="lang"\n            ></item-container>\n        </div>\n    '});const fleet_btn_style={normal:"btn btn-outline-secondary btn-sm fleet_op_btn p-0 w-50",yellow:"btn btn-outline-warning btn-sm fleet_op_btn p-0 w-50",text:"text-monospace text-center w-100 d-flex align-items-center justify-content-center border border-warning"};x=`${insertFleet}(,fleet.id[fleet.id.length-1],)`,Vue.component("fleet-container",{props:["fleet","lang"],template:`\n        <div class="d-grid justify-content-center fleet_box_o">\n            <div class="d-flex w-100">\n                <div class="line-5-item text-monospace text-center m-auto fleet_name" v-text="fleet.id">Fleet_ID</div>\n                <div class="d-flex line-5-item">\n                    <div class="d-flex btn-group w-100 m-auto">\n                        <button class="${fleet_btn_style.yellow}" v-bind:pos="fleet.id" data="1,0" onclick="${insertFleet.name}(this)">↑</button>    \n                        <div class="${fleet_btn_style.text}">Normal</div>                    \n                        <button class="${fleet_btn_style.yellow}" v-bind:pos="fleet.id" data="1,1" onclick="${insertFleet.name}(this)">↓</button>                        \n                    </div>\n                </div>\n                <div class="d-flex line-5-item">\n                    <div class="d-flex btn-group w-100 mx-1 my-auto">\n                        <button class="${fleet_btn_style.normal} border-right" v-bind:pos="fleet.id" onclick="${moveFleet.name}(this)" data="-1">↑</button>\n                        <button class="${fleet_btn_style.normal} border-left" v-bind:pos="fleet.id" onclick="${moveFleet.name}(this)" data="1">↓</button>\n                    </div>\n                </div>\n                <div class="d-flex line-5-item">\n                    <div class="d-flex btn-group w-100 m-auto">                        \n                        <button class="${fleet_btn_style.yellow}" v-bind:pos="fleet.id" data="2,0" onclick="${insertFleet.name}(this)">↑</button>\n                        <div class="${fleet_btn_style.text}">Sub</div>\n                        <button class="${fleet_btn_style.yellow}" v-bind:pos="fleet.id" data="2,1" onclick="${insertFleet.name}(this)">↓</button>\n                    </div>\n                </div>\n                <div class="d-flex line-5-item">\n                    <button class="btn btn-danger btn-sm w-25 mx-auto" v-bind:pos="fleet.id" onclick="${deleteFleet.name}(this)">X</button>\n                </div>\n            </div>\n            <div class="row m-2 border border-secondary py-2 fleet_box_i">\n                <div class="flex-col fleet_side_box" v-if="fleet.back_ship">\n                    <ship-container\n                        v-for="back_ship in fleet.back_ship"\n                        v-bind:key="back_ship.id"\n                        v-bind:ship="back_ship"\n                        v-bind:name="back_ship.id"\n                        v-bind:lang="lang"\n                    ></ship-container>\n                </div>\n                <div class="flex-col fleet_side_box" v-if="fleet.front_ship">\n                    <ship-container\n                        v-for="front_ship in fleet.front_ship"\n                        v-bind:key="front_ship.id"\n                        v-bind:ship="front_ship"\n                        v-bind:name="front_ship.id"\n                        v-bind:lang="lang"\n                    ></ship-container>\n                </div>\n                <div class="flex-col fleet_side_box" v-if="fleet.sub_ship">\n                    <ship-container\n                        v-for="sub_ship in fleet.sub_ship"\n                        v-bind:key="sub_ship.id"\n                        v-bind:ship="sub_ship"\n                        v-bind:name="sub_ship.id"\n                        v-bind:lang="lang"\n                    ></ship-container>\n                </div>\n            </div>\n        </div>\n    `});const filter_btn_class="btn btn-outline-secondary line-5-item py-2 font-weight-bold text-truncate filter-btn",filter_btn_template=`<button type="button" onclick="${updateSetting.name}(this)" class="${filter_btn_class}"></button>`;Vue.component("ship-nation-button",{props:["nation","lang"],template:filter_btn_template}),Vue.component("ship-type-button",{props:["type","lang"],template:filter_btn_template}),Vue.component("ship-rarity-button",{props:["rarity","lang"],template:filter_btn_template}),Vue.component("equip-nation-button",{props:["nation","lang"],template:filter_btn_template}),Vue.component("equip-type-button",{props:["type","lang"],template:filter_btn_template}),Vue.component("equip-rarity-button",{props:["rarity","lang"],template:filter_btn_template}),Vue.component("equip-tier-button",{props:["tier","lang"],template:filter_btn_template});const formation={v4:[1,1,1,1,2],v5:[1]},AFL_storage=window.localStorage,filter_setting={nation:new Set,front:new Set,back:new Set,sub:new Set,rarity:new Set,eq_nation:new Set,eq_rarity:new Set,eq_type:new Set,eq_tier:new Set},fleet_info={name:()=>document.querySelector("#fleet_name"),select:()=>document.querySelector("#select_fleet"),msg:()=>document.querySelector("#error_message"),list:()=>document.querySelector("#fleet_list"),load:()=>document.querySelector("#load_fleet"),remove:()=>document.querySelector("#remove_fleet")},msg_color={red:"text-danger",green:"text-success"},_loading_={ship:{},equip:{},cache_image:{},load_cache:{}},pos_table={back_sub:{0:2,1:1,2:3},front:{0:3,1:2,2:1}},type_front=new Set([1,2,3,18,19]),type_back=new Set([4,5,6,7,10,12,13]),type_sub=new Set([8,17]),other_nation=new Set([97,98,101,103,104,105,106,107,108,109,110]),other_front=new Set([19]),other_back=new Set([10]),other_sub=new Set([0]),addQuantityList=[1,2,3,4,5,6,7,8,9,11,12,13],eq_other_nation=new Set([104,105,106]),eq_nation=new Set(lan_eq_nation.map(e=>parseInt(e.id,10))),eq_type=new Set(lan_eq_type.map(e=>parseInt(e.id,10))),eq_rarity=new Set(lan_eq_rarity.map(e=>parseInt(e,10))),eq_tier=new Set(lan_eq_tier.map(e=>parseInt(e.id,10))),db_name="image_cache",db_ver=1,ALF_version=.05;let c_fleet="",c_side="",c_pos="",c_item="",c_ships=[],c_formation=[],retrofit_only=!0,fleet_data=buildFleet(formation.v5),sorted_ship_data=[],sorted_equip_data=[],fleet_in_storage=[],eqck=!1,lan="en";Object.defineProperty(Array.prototype,"isAll",{value:function(){return this.every(e=>Boolean(e))}}),Object.defineProperty(Array.prototype,"sameAs",{value:function(e){if(!(e instanceof Array))throw Error(`[${e}] (${typeof e}) is not Array!!`);return JSON.stringify(this)===JSON.stringify(e)}});const sleep=(e=0)=>new Promise(t=>setTimeout(t,e)),indexInObj=(e,t=!1)=>{let n=[];if(t)for(let t in e)n.push(t,e[t]);else for(let t in e)n.push(t);return n};initial();const ALF=new Vue({el:"#AzurLaneFleetApp",data:{fleets:fleet_data,lang:lan}}),shipSelect=new Vue({el:"#shipselect",data:{nation:lan_ship_nation,type:lan_ship_type,rarity:lan_ship_rarity,lang:lan}}),equipSelect=new Vue({el:"#equipselect",data:{nation:lan_eq_nation,type:lan_eq_type,rarity:lan_eq_rarity,tier:lan_eq_tier,lang:lan}});