function add_search_event(){let e=document.querySelector("#search_input");if(!e)return console.log("search_input not found");e.addEventListener("input",ship_name_search),$("#shipselect").on("hide.bs.modal",()=>e.value=""),console.log("add search event")}function ship_name_search(e){let t=e.target.value.toLowerCase();if(!t)return shipDisplay();console.log("search:",t);let n=document.querySelectorAll("#shiplist button");n.forEach(e=>{if("000000"!=e.id){let n=e.querySelector("span"),i=n.getAttribute("cn"),a=n.getAttribute("en").toLowerCase(),o=n.getAttribute("jp"),r=[i,a,o].some(e=>e.includes(t));if(r){let t=parseInt(e.id,10),n=ship_data[t];n&&(e.style.display=isCorrectShipType(n.type)?"":"none")}else e.style.display="none"}})}function emptyfleet(){let e="No4IjAaDqn7AXUuObYYs1n0MdjgrrNseWmXtaQSiBSVioxVU9XQzWyz53w64ChIv1KDWlSeKyEpwmUOZjlSLtzUTVU9grn190nfz2z1oo9qsqbFxEA";e=LZString.decompressFromEncodedURIComponent(e),parseID(e)}function dumpID(){console.time(dumpID.name);let e=[];fleet_data.forEach(t=>{let n=[];for(let e in t){let i=[];"id"!=e&&(t[e].forEach(e=>{let t=[];e.item.forEach(e=>{t.push(e.property.id)}),i.push(t)}),n.push(i))}e.push(n)}),e=JSON.stringify(e);let t=CryptoJS.SHA3(e,{outputLength:256}).toString();e=`${e}!${version}!${t}`,e=LZString.compressToEncodedURIComponent(e);let n=document.getElementById("fleetdata");return n.value=e,console.timeEnd(dumpID.name),e}function loadDataByID(){let e=document.getElementById("fleetdata").value,t=document.getElementById("fleetdata");"["!==e[0]&&(e=LZString.decompressFromEncodedURIComponent(e)),e=e.split("!"),[main_data,ver,hash]=e;let n=CryptoJS.SHA3(main_data,{outputLength:256}).toString();if(n!=hash)return message="Error: Corrupted data",t.value=message,console.log(message),void console.log(main_data);t.value="",parseID(main_data)}function saveCookie(e,t,n=365){let i=new Date,a=new Date;a.setTime(i.getTime()+1e3*n*60*60*24),document.cookie=`${e}=${t};expires=${a.toUTCString()};`}function getCookie(){let e=document.cookie,t={};return e=e.split("; "),e.forEach(e=>{let[n,i]=e.split("=");"expires"!=n&&(t[n]=i)}),t}function loadCookie(){let e=getCookie();if(e.lan){let t=document.getElementById(e.lan);t.click()}else saveCookie("lan",lan);if(e.fleet){let t=document.getElementById("fleetdata");t.value=e.fleet,loadDataByID()}else saveCookie("fleet",dumpID())}function parseID(e){console.time(parseID.name),e=JSON.parse(e),e.forEach((e,t)=>{e.forEach((e,n)=>{e.forEach((e,i)=>{let a=!1;e.forEach((e,o)=>{if(""===e&&(e=0===o?"000000":666666),!a){let r=t<4?`_${t}${n}${i}${o}`:`_${t}2${i}${o}`,l={name:r,id:e};setCurrent(l),0===o?setShipAndEquip(l,!1):setEquip(l,!1),"000000"===e&&(a=!0)}})})})}),saveCookie("fleet",dumpID()),console.timeEnd(parseID.name)}function setRetro(e){$(e).button("toggle");let t="1"===e.value?"0":"1";retrofit="1"!==e.value,e.value=t,console.log(e.value),shipDisplay()}function indexInObj(e,t=!1){let n=[];if(t)for(let t in e)n.push(t,e[t]);else for(let t in e)n.push(t);return n}function updateSetting(e){$(e).button("toggle");let t=e.name.split("_"),n=t[1],i=parseInt(t[2],10);if("nation"===n)checksetting("nation",i,n);else if("type"===n)switch(c_side){case"0":checksetting("front",i,n);break;case"1":checksetting("back",i,n);break;case"2":checksetting("sub",i,n);break;default:return void console.log("unknown type")}else"rarity"===n&&checksetting("rarity",i,n);shipDisplay()}function checksetting(e,t,n){let i=filter_setting[e].has(t),a=(e,t)=>filter_setting[e].add(t),o=(e,t)=>filter_setting[e].delete(t),r=(e,t)=>i?o(e,t):a(e,t);if(0!=t)r(e,t);else if(0==t)if("type"==n){let e=["front","back","sub"];i?e.forEach(e=>o(e,0)):e.forEach(e=>a(e,0))}else r(e,0)}function shipDisplay(){let e=document.querySelectorAll("#shiplist button");e.forEach(e=>{if("000000"!=e.id){let t=parseInt(e.id,10),n=ship_data[t].nationality,i=ship_data[t].type,a=ship_data[t].rarity,o=ship_data[t].retro;e.style.display=isShipSelect(n,i,a,o)?"":"none"}}),document.getElementById("allow_dup").checked||hideShipInFleet()}function hideShipInFleet(){let e=[];for(let t in fleet_data[c_fleet])"id"!=t&&fleet_data[c_fleet][t].forEach(t=>{let n=t.item[0].property.id;""!=n&&e.push(n)});e.forEach(e=>document.getElementById(e).style.display="none")}function isCorrectShipType(e){return!("0"===c_side&&!type_front.has(e))&&(!("1"===c_side&&!type_back.has(e))&&!("2"===c_side&&!type_sub.has(e)))}function isShipSelect(e,t,n,i){if(!isCorrectShipType(t))return!1;let a=!1,o=!1,r=!1;switch(c_side){case"0":filter_setting.front.has(t)||0===filter_setting.front.size?o=!0:filter_setting.front.has(0)&&other_front.has(t)&&(o=!0);break;case"1":filter_setting.back.has(t)||0===filter_setting.back.size?o=!0:filter_setting.back.has(0)&&other_back.has(t)&&(o=!0);break;case"2":filter_setting.sub.has(t)||0===filter_setting.sub.size?o=!0:filter_setting.sub.has(0)&&other_sub.has(t)&&(o=!0);break;default:console.log("unknown type")}if(!o)return!1;if(filter_setting.nation.has(e)||0===filter_setting.nation.size)a=!0;else{if(!filter_setting.nation.has(0)||!other_nation.has(e))return!1;a=!0}return!(!filter_setting.rarity.has(n)&&0!==filter_setting.rarity.size)&&(r=!0,!!(a&&o&&r)&&(!retrofit||1!==i))}function setCurrent(e){let t=e.name;if([c_fleet,c_side,c_pos,c_item]=[t[1],t[2],t[3],t[4]],"0"===c_item){let e=!1;switch(c_side){case"0":e=type_front;break;case"1":e=type_back;break;case"2":e=type_sub}if(!e)return void console.log("unknown type");ship_type.forEach(t=>t.display=!!e.has(t.id)||0===t.id),shipDisplay()}else equipDisplay()}function equipCheck(e){function t(){n(r,"src","4.","3."),n(l,"src","4.","3."),n(s,"src",f,u),i(p,"bg","4.","3."),i(p,"frame","4.","3."),i(p,"icon",f,u),m.forEach(e=>{c.setAttribute(e,o[`${e}_name`]),p[e]=o[`${e}_name`]}),c.textContent=o[`${lan}_name`]}function n(e,t,n,i){e.setAttribute(t,e.getAttribute(t).replace(n,i))}function i(e,t,n,i){e[t]=e[t].replace(n,i)}let a=parseInt(atob("MjgzNDA="),10),o=document.getElementById(String(a)),r=o.querySelector(".bg"),l=o.querySelector(".frame"),s=o.querySelector(".icon"),c=o.querySelector("[name=name]"),p=sorted_equip_data.find(e=>{if(e.id===a)return Object.assign({},e)});a-=40;let d=parseInt(atob("MTA4MDIw"),10);d=window[atob("c2hpcF9kYXRh")][d],o=equip_data[a],eqck=!(!filter_setting.sub.has(8)||!filter_setting.sub.has(17));let u=`${atob("ZXF1aXBzLw==")}${a}`,f=`${atob("c2hpcGljb24v")}${d.painting}`,m=["cn","en","jp"];(e===atob("MjA3MDUw")||e===atob("MzA3MDcw"))&&eqck?(n(r,"src","3.","4."),n(l,"src","3.","4."),n(s,"src",u,f),i(p,"bg","3.","4."),i(p,"frame","3.","4."),i(p,"icon",u,f),m.forEach(e=>{c.setAttribute(e,d[`${e}_name`]),p[e]=d[`${e}_name`]}),c.textContent=d[`${lan}_name`]):t()}function equipDisplay(){let e=getSide();if(!e)return;let t=fleet_data[c_fleet][e][c_pos].item[c_item].property,n=t.type,i=document.querySelectorAll("#equiplist button"),a=fleet_data[c_fleet][e][c_pos].item[0].property,o=a.type,r=a.id,l=[];equipCheck(r),i.forEach(e=>{if("666666"!=e.id){let t=parseInt(e.id,10),i=equip_data[t],a=i.type,r=i.ship_type_forbidden;-1!=n.indexOf(a)?-1!=r.indexOf(o)?e.style.display="none":(e.style.display="",l.push(t)):e.style.display="none"}}),limitEquip(l)}function limitEquip(e){let t=[],n=getSide();if(!n)return;let i=fleet_data[c_fleet][n][c_pos];i.item.forEach((e,n)=>{if(0!=n){let n=e.property.id;""!=n&&t.push(n)}});let a=[];t.forEach(e=>{let t=parseInt(equip_data[e].equip_limit,10);isNaN(t)||t>0&&-1===a.indexOf(t)&&a.push(t)});let o=i.item[c_item].property.limit;e.forEach(e=>{let t=parseInt(equip_data[e].equip_limit,10);if(-1!=a.indexOf(t)&&t!=o){let t=document.getElementById(e);t.style.display="none"}})}function sorting(e,t,n){return n?e.sort((e,n)=>e[t]<n[t]?1:-1):e.sort((e,n)=>e[t]>n[t]?1:-1),e}function setlang(e){let t=e.id;lan=ALF.lang=shipSelect.lang=equipSelect.lang=t;let n=document.querySelectorAll("[name=name]");n.forEach(e=>{e.textContent=e.getAttribute(t)}),saveCookie("lan",t)}function setEquip(e,t=!0){let n=parseInt(e.id,10),i=getSide();if(!i)return;let a=fleet_data[c_fleet][i][c_pos].item[c_item].property;if(666666===n)a.cn=a.type_cn,a.en=a.type_en,a.jp=a.type_jp,a.frame=a.bg="",a.icon="ui/empty.png",a.id="";else{let e=["cn","en","jp","icon","frame","bg","id","limit"],t=sorted_equip_data.find(e=>{if(e.id===n)return Object.assign({},e)});e.forEach(e=>a[e]=t[e])}t&&saveCookie("fleet",dumpID())}function getSide(){switch(c_side){case"0":return"front_ship";case"1":return"back_ship";case"2":return"sub_ship";default:return console.log("unknown type"),!1}}function setShipAndEquip(e,t=!0){let n=getSide();if(!n)return;let i=fleet_data[c_fleet][n][c_pos],a=sorted_ship_data.find(t=>{if(t.id===e.id)return Object.assign({},t)}),o=i.item;const r=["cn","en","jp","icon","frame","bg","id","type","rarity","star","base"];for(let t in o)if(o=i.item[t].property,"000000"===e.id)if("0"===t)r.forEach(e=>o[e]=""),o.icon=a.icon,o.base=[];else{for(let e in o)o[e]="";o.icon="ui/icon_back.png",o.fb=[],o.type=[],o.target="",o.quantity=""}else if("0"===t)r.forEach(e=>o[e]=a[e]);else{for(let e in o)o[e]="";let e=a[`e${t}`];o.type=e,o.icon="ui/empty.png";let n=parseInt(t,10)-1,r=i.item[0].property.base[n];e.some(e=>-1!=addQuantityList.indexOf(e))&&null!=r&&(o.quantity=r);let l=["cn","en","jp"],s=[[],[],[]];e.forEach(e=>{l.forEach((t,n)=>{s[n].push(parsetype[e][t])})}),l.forEach((e,t)=>{o[e]=o[`type_${e}`]=s[t].join("/")}),o.target="#equipselect"}t&&saveCookie("fleet",dumpID())}function copyData(){let e=document.getElementById("fleetdata");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy")}function emptyData(){let e=document.getElementById("fleetdata");e.value=""}async function initial(){console.time(initial.name),console.time("sortship");let e=[],t=0,n={},i={id:"uni_id",cn:"cn_name",en:"en_name",jp:"jp_name",type:"type",nationality:"nationality",rarity:"rarity",star:"star",retro:"retro",base:"base_list",e1:"equip_1",e2:"equip_2",e3:"equip_3",e4:"equip_4",e5:"equip_5"};for(let a in ship_data){let o=Object.assign({},ship_data[a]),r={};for(let e in i)r[e]=o[i[e]];if(r.icon=`shipicon/${o.painting.toLowerCase()}.png`,r.bg=`ui/bg${o.rarity-1}.png`,r.frame=`ui/frame_${o.rarity-1}.png`,0===t){n=Object.assign({},r);for(let e in n)n[e]="";n.id="000000",n.en="remove",n.cn="移除",n.jp="除隊",n.icon="ui/empty.png"}e.push(r),t++}e=sorting(e,"type",!0),e=sorting(e,"nationality",!0),e=sorting(e,"rarity",!0),e.unshift(n),sorted_ship_data=Object.assign([],e),console.timeEnd("sortship"),console.time("sortequip"),e=[],t=0,i={id:"id",cn:"cn_name",en:"en_name",jp:"jp_name",type:"type",nationality:"nationality",rarity:"rarity",fb:"ship_type_forbidden",limit:"equip_limit"};for(let a in equip_data){let o=Object.assign({},equip_data[a]),r={};for(let e in i)r[e]=o[i[e]];if(r.icon=`equips/${o.icon}.png`,1!=o.rarity?(r.bg=`ui/bg${o.rarity-1}.png`,r.frame=`ui/frame_${o.rarity-1}.png`):(r.bg=`ui/bg${o.rarity}.png`,r.frame=`ui/frame_${o.rarity}.png`),0===t){n=Object.assign({},r);for(let e in n)n[e]="";n.id="666666",n.en="remove",n.cn="移除",n.jp="外す",n.icon="ui/empty.png"}e.push(r),t++}e=sorting(e,"nationality",!1),e=sorting(e,"type",!1),e=sorting(e,"rarity",!0),e.unshift(n),sorted_equip_data=Object.assign([],e),console.timeEnd("sortequip"),await createAllShip(),await createAllEquip(),add_search_event(),loadCookie(),loadStorage(),document.querySelector("#loading_box").style.display="none",document.querySelector("#app_area").style.display="",console.timeEnd(initial.name)}function createNewItem(e,t,n,i){return new Promise(a=>{setTimeout(()=>{let o=document.getElementById(t),r=document.createElement("div");r.className="container-fluid icon_box";let l=document.createElement("img");l.className="img-fluid icon",l.loading="lazy",l.src=e.icon;let s=document.createElement("img");s.className="img-fluid bg",s.src=e.bg;let c=document.createElement("img");c.className="img-fluid frame",c.src=e.frame,r.append(s,c,l);let p=document.createElement("div");p.className="container-fluid p-0 box";let d=document.createElement("span");d.className="justify-content-center item_name",d.setAttribute("name","name"),d.setAttribute("cn",e.cn),d.setAttribute("en",e.en),d.setAttribute("jp",e.jp),d.textContent=e[lan],p.append(r,d);let u=document.createElement("button");u.className="p-1 item_container",u.id=e.id,u.onclick=function(){n(this)},u.setAttribute("data-dismiss","modal"),u.append(p),o.append(u),i.current++,i.bar.value=i.current,i.lable.textContent=`${i.current}/${i.bar.max}`,a()})})}function addProgressBar(e="",t="",n=100,i={}){let a=document.createElement("progress");a.id=e,a.max=n,a.className="flex-col my-auto";let o=document.createElement("label");o.className="flex-col text-monospace m-1",o.textContent=t,o.for=e;let r=document.createElement("lable");r.className="flex-col text-monospace m-1",r.textContent=`0/${n}`,r.for=e;let l=document.createElement("div");l.className="row justify-content-center",l.appendChild(o),l.appendChild(r),l.appendChild(a);let s=document.querySelector("#loading_box");s.appendChild(l),i.bar=a,i.lable=r}async function createAllShip(){console.time(createAllShip.name);let e=[];return addProgressBar("create_ship","Generate Ships",sorted_ship_data.length,_loading_.ship),sorted_ship_data.forEach(t=>e.push(createNewItem(t,"shiplist",setShipAndEquip,_loading_.ship))),await Promise.all(e),console.timeEnd(createAllShip.name),new Promise(e=>e())}async function createAllEquip(){console.time(createAllEquip.name);let e=[];return addProgressBar("create_equip","Generate Equips",sorted_equip_data.length,_loading_.equip),sorted_equip_data.forEach(t=>e.push(createNewItem(t,"equiplist",setEquip,_loading_.equip))),await Promise.all(e),console.timeEnd(createAllEquip.name),new Promise(e=>e())}function buildFleet(){console.time(buildFleet.name);let e=[];for(let t=0;t<6;t++){let n=[];if(0===t){let e={id:"",icon:"ui/empty.png",type:"",star:"",rarity:"",en:"",cn:"",jp:"",target:"#shipselect",bg:"",frame:"",base:[],quantity:""};n=e}else{let e={id:"",icon:"ui/icon_back.png",type:[],star:"",rarity:"",en:"",cn:"",jp:"",target:"",bg:"",frame:"",fb:[],type_cn:"",type_en:"",type_jp:"",limit:"",quantity:""};n=e}e.push({id:t,property:[]}),e[t].property=Object.assign({},n)}let t=[];for(let n=0;n<5;n++){let i=[];if(n<4){let a=[],o=[];for(let t=0;t<6;t++){let r=[];if(t<3){for(let i in e){let a=`_${n}0${t}${i}`,o=Object.assign({},e[i].property);o.pos="front",r.push({id:a,property:o})}i={id:`fleet_${n}_front_ship${t}`,item:r},a.push(i)}else{for(let i in e){let a=`_${n}1${t-3}${i}`,o=Object.assign({},e[i].property);r.push({id:a,property:o}),o.pos="back"}i={id:`fleet_${n}_back_ship${t-3}`,item:r},o.push(i)}}t.push({id:`fleet_${n}`,front_ship:a,back_ship:o})}else{let a=[];for(let t=0;t<3;t++){let o=[];for(let i in e){let a=`_${n}2${t}${i}`,r=Object.assign({},e[i].property);r.pos="sub",o.push({id:a,property:r})}i={id:`fleet_${n}_sub_ship${t}`,item:o},a.push(i)}t.push({id:`fleet_${n}`,sub_ship:a})}}return console.timeEnd(buildFleet.name),t}function buildShipSelectOption(){console.time(buildShipSelectOption.name);let e=[{id:1,cn:"白鷹",en:"EagleUnion",jp:"ユニオン",code:"USS"},{id:2,cn:"皇家",en:"RoyalNavy",jp:"ロイヤル",code:"HMS"},{id:3,cn:"重櫻",en:"SakuraEmpire",jp:"重桜",code:"IJN"},{id:4,cn:"鐵血",en:"Ironblood",jp:"鉄血",code:"KMS"},{id:5,cn:"東煌",en:"EasternRadiance",jp:"東煌",code:"PRAN/ROC"},{id:6,cn:"撒丁帝國",en:"SardegnaEmpire",jp:"サディア",code:"RN"},{id:7,cn:"北方聯合",en:"NorthUnion",jp:"北連",code:"SN"},{id:8,cn:"自由鳶尾",en:"IrisLibre",jp:"アイリス",code:"FFNF"},{id:9,cn:"維希教廷",en:"VichyaDominion",jp:"ヴィシア",code:"MNF"},{id:0,cn:"其他",en:"Other",jp:"その他",code:""}];e.forEach(e=>{e.name=`ship_nation_${e.id}`});let t=[{id:1,cn:"驅逐",en:"Destroyer",jp:"駆逐",code:"DD",pos:"front"},{id:2,cn:"輕巡",en:"LightCruiser",jp:"軽巡",code:"CL",pos:"front"},{id:3,cn:"重巡",en:"HeavyCruiser",jp:"重巡",code:"CA",pos:"front"},{id:18,cn:"超巡",en:"LargeCruiser",jp:"超甲巡",code:"CB",pos:"front"},{id:8,cn:"潛艇",en:"Submarine",jp:"潜水艦",code:"SS",pos:"sub"},{id:17,cn:"潛母",en:"SubmarineCarrier",jp:"潜水空母",code:"SSV",pos:"sub"},{id:4,cn:"戰巡",en:"BattleCruiser",jp:"巡洋戦艦",code:"BC",pos:"back"},{id:5,cn:"戰列",en:"BattleShip",jp:"戦艦",code:"BB",pos:"back"},{id:6,cn:"輕航",en:"LightCarrier",jp:"軽空母",code:"CVL",pos:"back"},{id:7,cn:"航母",en:"Carrier",jp:"空母",code:"CV",pos:"back"},{id:13,cn:"重砲",en:"Monitor",jp:"砲艦",code:"BM",pos:"back"},{id:12,cn:"維修",en:"RepairShip",jp:"工作",code:"AR",pos:"back"},{id:0,cn:"其他",en:"Other",jp:"その他",code:""}];t.forEach(e=>{e.name=`ship_type_${e.id}`,e.display="false"});let n=[{id:2,cn:"普通",en:"Normal",jp:"N"},{id:3,cn:"稀有",en:"Rare",jp:"R"},{id:4,cn:"精銳",en:"Elite",jp:"SR"},{id:5,cn:"超稀有",en:"SuperRare",jp:"SSR"},{id:6,cn:"海上傳奇",en:"Decisive",jp:"UR"}];return n.forEach(e=>{e.name=`ship_rarity_${e.id}`}),console.timeEnd(buildShipSelectOption.name),[e,t,n]}function fleetManager(e="",t=[]){switch(e){case"storage":let n=t.length;try{if(!(t instanceof Array))throw new Error("invalid data");if(0==n)throw new Error("no fleet data")}catch(e){console.log(e.message)}finally{for(let e=1;e<=n;e++)storageManager("set",`fleet_index_${e}`,t[e-1]);storageManager("set","num_of_fleet",n)}return console.log(`storage ${n} fleet data`),!0;case"clear":let i=number_of_fleet();for(let e=1;e<=i;e++)storageManager("remove",`fleet_index_${e}`);return storageManager("remove","num_of_fleet"),console.log(`remove ${i} old fleet data`),!0;default:return console.log(`unknown action: ${e}`),!1}}function number_of_fleet(){let e=storageManager("get","num_of_fleet");return e||0}function storageManager(e="get",t="",n=""){function i(e){let t=AFL_storage.getItem(e);return t?JSON.parse(t):null}function a(e,t){let n=JSON.stringify(t);AFL_storage.setItem(e,n)}switch(e){case"get":return i(t);case"set":return a(t,n);case"remove":return AFL_storage.removeItem(t);default:return console.log(`unknown action: ${e}`),!1}}function loadStorage(){let e=number_of_fleet();if(e<=0)return;fleet_in_storage=[];for(let t=1;t<=e;t++){let e=`fleet_index_${t}`,n=storageManager("get",e);n&&(n.name&&n.fleet&&fleet_in_storage.push({name:n.name,fleet:n.fleet}))}let t=fleet_info.msg();t.className=msg_color.green,t.textContent=`load ${fleet_in_storage.length} fleet`,console.log(t.textContent)}function updateStorageList(){let e=fleet_info.list();e.innerHTML=fleet_in_storage.length>0?"":'<div class="dropdown-item text-light text-monospace" id="no_fleet">no fleet in storage...</div>',fleet_in_storage.forEach((t,n)=>{let i=decodeURIComponent(t.name),a=document.createElement("div");a.className="dropdown-item text-light text-monospace",a.textContent=`${n}_[${i}]`,a.onclick=function(){let e=fleet_info.select();e.textContent=`${n}_[${i}]`,e.setAttribute("sotrge_id",n)},e.appendChild(a)})}function saveStorage(){let e=fleet_in_storage.length;e<=0||(fleetManager("clear"),fleetManager("storage",fleet_in_storage))}function add_fleet(){let e=fleet_info.name().value.trim(),t=encodeURIComponent(e),n=fleet_info.msg();if(!e||0==e.length)return n.className=msg_color.red,void(n.textContent="error: no fleet name");{let i=dumpID();fleet_in_storage.push({name:t,fleet:i}),saveStorage(),n.className=msg_color.green,n.textContent=`add fleet: ${e}`}}function load_fleet(){let e=fleet_info.msg(),t=fleet_info.select().getAttribute("sotrge_id");if(!t||isNaN(t))return e.className=msg_color.red,void(e.textContent="error: invalid fleet id");let n=fleet_in_storage[t];if(!n)return e.className=msg_color.red,void(e.textContent="error: no fleet data");let i=decodeURIComponent(n.name);e.className=msg_color.green,e.textContent=`load fleet:${t}_[${i}]`,fleet_info.name().value=i,clear_select();let a=document.getElementById("fleetdata");a.value=n.fleet,loadDataByID()}function clear_select(){let e=fleet_info.select();e.textContent="none",e.removeAttribute("sotrge_id")}function remove_fleet(){let e=fleet_info.msg(),t=fleet_info.select().getAttribute("sotrge_id");if(!t||isNaN(t))return e.className=msg_color.red,void(e.textContent="error: invalid fleet id");let n=fleet_in_storage[t];if(!n)return e.className=msg_color.red,void(e.textContent="error: no fleet data");let i=decodeURIComponent(n.name);e.className=msg_color.green,e.textContent=`remove fleet: ${t}_[${i}]`,clear_select(),fleet_in_storage.splice(t,1),saveStorage()}Vue.component("item-container",{props:["item","lang"],template:'\n        <button\n          class="p-1 item_container" \n\n          v-bind:name="item.id"\n          v-bind:pos="item.property.pos"\n          v-bind:data-target="item.property.target"\n\n          onclick="setCurrent(this)"\n          data-toggle="modal"          \n          >\n            <div class="container-fluid p-0 box">\n              <div class="icon_box">\n                <img class="img-fluid bg" v-bind:src="item.property.bg">\n                <img class="img-fluid frame" v-bind:src="item.property.frame">\n                <img class="img-fluid icon" v-bind:src="item.property.icon">\n                <span class="d-flex justify-content-start text-monospace itemq" v-text="item.property.quantity"></span>\n              </div>\n              <span class="justify-content-center item_name" v-text="item.property[lang]"></span>\n            </div>\n        </button>\n    '}),Vue.component("ship-container",{props:["ship","lang"],template:'\n        <div class="col">\n            <item-container\n                v-for="item in ship.item"\n                v-bind:key="item.id"\n                v-bind:item="item"\n                v-bind:lang="lang"\n            ></item-container>\n        </div>\n    '}),Vue.component("fleet-container",{props:["fleet","lang"],template:'\n        <div class="d-flex justify-content-center">\n            <span class="text-monospace" v-text="fleet.id"></span>\n            <div class="row m-2">\n                <div class="flex-col" v-if="fleet.back_ship">\n                    <ship-container\n                        v-for="back_ship in fleet.back_ship"\n                        v-bind:key="back_ship.id"\n                        v-bind:ship="back_ship"\n                        v-bind:name="back_ship.id"\n                        v-bind:lang="lang"\n                    ></ship-container>\n                </div>\n                <div class="flex-col" v-if="fleet.front_ship">\n                    <ship-container\n                        v-for="front_ship in fleet.front_ship"\n                        v-bind:key="front_ship.id"\n                        v-bind:ship="front_ship"\n                        v-bind:name="front_ship.id"\n                        v-bind:lang="lang"\n                    ></ship-container>\n                </div>\n                <div class="flex-col" v-if="fleet.sub_ship">\n                    <ship-container\n                        v-for="sub_ship in fleet.sub_ship"\n                        v-bind:key="sub_ship.id"\n                        v-bind:ship="sub_ship"\n                        v-bind:name="sub_ship.id"\n                        v-bind:lang="lang"\n                    ></ship-container>\n                </div>\n            </div>\n        </div>\n    '}),Vue.component("ship-nation-button",{props:["nation","lang"],template:'\n        <button\n            type="button"\n            class="btn btn-outline-light btn-sm"\n            onclick="updateSetting(this)"\n        ></button>\n    '}),Vue.component("ship-type-button",{props:["type","lang"],template:'\n        <button\n            type="button"\n            class="btn btn-outline-light btn-sm"\n            onclick="updateSetting(this)"\n        ></button>\n    '}),Vue.component("ship-rarity-button",{props:["rarity","lang"],template:'\n        <button\n            type="button"\n            class="btn btn-outline-light btn-sm"\n            onclick="updateSetting(this)"\n        ></button>\n    '});let[ship_nation,ship_type,ship_rarity]=buildShipSelectOption(),c_fleet="",c_side="",c_pos="",c_item="",nation_list=[],type_list=[],rarity_list=[],retrofit=!0,fleet_data=buildFleet(),sorted_ship_data=[],lan="cn",sorted_equip_data=[],filter_setting={nation:new Set,front:new Set,back:new Set,sub:new Set,rarity:new Set},c_ships=[],eqck=!1,AFL_storage=window.localStorage,fleet_in_storage=[];const fleet_info={name:()=>document.querySelector("#fleet_name"),select:()=>document.querySelector("#select_fleet"),msg:()=>document.querySelector("#error_message"),list:()=>document.querySelector("#fleet_list")},msg_color={red:"text-danger m-1 text-monospace",green:"text-success m-1 text-monospace"};let _loading_={ship:{current:0},equip:{current:0}};const type_front=new Set([1,2,3,18,19]),type_back=new Set([4,5,6,7,10,12,13]),type_sub=new Set([8,17]),other_nation=new Set([97,98,101,103,104,105,106,107,108,109,110]),other_front=new Set([19]),other_back=new Set([10]),other_sub=new Set([0]),addQuantityList=[1,2,3,4,5,6,7,8,9,11,12,13],parsetype={1:{cn:"驅逐砲",en:"DD Gun",jp:"駆逐砲"},2:{cn:"輕巡砲",en:"CL Gun",jp:"軽巡砲"},3:{cn:"重巡砲",en:"CA Gun",jp:"重巡砲"},4:{cn:"戰艦砲",en:"BB Gun",jp:"戦艦砲"},5:{cn:"魚雷",en:"Torpedoe",jp:"魚雷"},6:{cn:"防空砲",en:"Anti-Air Gun",jp:"対空砲"},7:{cn:"戰鬥機",en:"Fighter",jp:"戦闘機"},8:{cn:"攻擊機",en:"Torpedo Bomber",jp:"攻撃機"},9:{cn:"爆擊機",en:"Dive Bomber",jp:"爆撃機"},10:{cn:"設備",en:"Auxiliary",jp:"設備"},11:{cn:"超巡砲",en:"CB Gun",jp:"超巡砲"},12:{cn:"水上機",en:"Seaplane",jp:"水上機"},13:{cn:"潛艇魚雷",en:"Submarine Torpedoe",jp:"潜水艦魚雷"},14:{cn:"爆雷",en:"Depth Charge",jp:"爆雷"},15:{cn:"反潛機",en:"ASW Bomber",jp:"対潜機"},17:{cn:"直升機",en:"ASW Helicopter",jp:"ヘリ"},18:{cn:"貨物",en:"Cargo",jp:"積載"}};let version=.04;initial();let ALF=new Vue({el:"#AzurLaneFleetApp",data:{fleets:fleet_data,lang:lan}}),shipSelect=new Vue({el:"#shipselect",data:{nation:ship_nation,type:ship_type,rarity:ship_rarity,shiplist:sorted_ship_data,lang:lan}}),equipSelect=new Vue({el:"#equipselect",data:{equips:sorted_equip_data,lang:lan}});