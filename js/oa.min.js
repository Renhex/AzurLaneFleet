import{firebaseapp,auth}from"./firebase.js";const url_shortener=async(e="",t=!1)=>{async function n(){const e=new firebaseapp.auth.GithubAuthProvider;try{let t=await firebaseapp.auth().signInWithPopup(e),n=t.credential,r=n.accessToken,a=t.user;return console.log({credential:n,token:r,user:a}),{credential:n,token:r,user:a}}catch(e){let{code:t,message:n,email:r,credential:a}=e;return{code:t,message:n,email:r,credential:a}}}async function r(e,t){const n="alft-db",r=`https://api.github.com/repos/renhex/${n}/issues`;let a=new Headers({Accept:"application/vnd.github.v3+json",Authorization:`Bearer ${e}`,"Content-Type":"application/json"}),i={title:t,body:"this is create by app",assignees:[],labels:[],milestone:null},o={method:"POST",headers:a,body:JSON.stringify(i),redirect:"follow"};try{let e=await fetch(r,o);return e=await e.json(),{num:e.number,user:e.user.login}}catch(e){return console.log("error",e),!1}}let a=!1;if(t){let n=await r(t,e);if(n)return a=!0,{url:`https://renhex.github.io/alft/${n.num}`,token:t}}if(!a||!t){let t=await n();if(t.token){let n=await r(t.token,e);return!!n&&{url:`https://renhex.github.io/alft/${n.num}`,token:t.token}}return console.log("unable to get github token",t),!1}};